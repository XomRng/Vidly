@using Vidly.Models

@model List<Customer>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<h2>Klienci</h2>
@{
    if (@Model.Count == 0)
    {
        <p>Nie mamy w tym momencie żadnych klientów.</p>
    }
    else
    {
        //Tag "id=customers" dany na potrzeby java scripta
        <table id ="customers" class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>Klient  </th>
                    <th>Discount Rate</th>
                    <th>Membership type</th>
                    <th>Delete</th>
                    
                </tr>
            </thead>
            <tbody>
            @foreach (Customer cust in Model)
            {

                <tr>
                    @*<td>@Html.ActionLink(@cust.Name, "GetCustomer", "Customers", new { id = @cust.Id }, null)</td>*@
                    <td>@Html.ActionLink(@cust.Name, "Edit", "Customers", new { id = @cust.Id }, null)</td>

                    <td>@cust.MembershipType.DiscountRate%</td>
                    <td>@cust.MembershipType.Name</td>
                    <td>
                        <button data-customer-id="@cust.Id" class="btn-link js-delete">Kasuj</button>
                        @*js-delete to specjalna referencja dla javascripta by ja widzial *@
                    </td>
                </tr>
                
                
            }
            </tbody>

        </table>
    }

}

<p><a class="btn btn-default" href="@Url.Action("New", "Customers")">Nowy klient &raquo;</a></p>
       
@section scripts
{
    <script>
        $(document).ready(function () {
            $("#customers").DataTable();
            $("#customers").on("click", ".js-delete",
                function () {
                    var button = $(this)
                    bootbox.confirm("Czy jesteś pewny, że chcesz skasować tego klienta", function(result) {
                        if (result) {
                            $.ajax({
                                url: "/api/customers/" + button.attr("data-customer-id"),
                                method: "DELETE",
                                success: function () {
                                    button.parent("tr").remove();
                                }
                            });
                        }
                    })
                });
        });
    </script>
}